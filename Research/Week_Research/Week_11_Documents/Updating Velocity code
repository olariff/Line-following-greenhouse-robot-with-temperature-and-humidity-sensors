#include "mbed.h"

PwmOut velocity(p22);
float vo=0;
// Velocity expects -1 (reverse) to +1 (forward)
void Velocity(float v) {
    v=v+1;
    if (v>=0 && v<=2) {
        if (vo>=1 && v<1) {                 //
            velocity.pulsewidth(0.0014);    // this is required to
            wait(0.1);                      //
            velocity.pulsewidth(0.0015);    // move into reverse
            wait(0.1);                      //
        }                                   //
        velocity.pulsewidth(v/2000+0.001);
        vo=v;
    }
}

int main() 
{ 
    velocity.period(0.02);
    Velocity(0); // initiate the drive motor (this must be done)
    wait(0.5);
    
    
    Velocity(0.15); // try to keep cnostant speed at 15% of the full speed
    wait(10);        // for 5 sec

}